/* 
 * Simple stealth mode script for Playwright to minimize detection
 * This helps avoid common anti-bot measures on websites
 */

() => {
  // Override the navigator properties
  const newProto = navigator.__proto__;
  delete newProto.webdriver;

  // Override navigator plugin functionality
  const originalGetPlugins = navigator.plugins.__proto__.item;
  navigator.plugins.__proto__.item = function(index) {
    return originalGetPlugins.call(this, index);
  };

  // Override navigator platform
  Object.defineProperty(navigator, 'platform', {
    get: function() {
      return 'MacIntel';
    }
  });

  // Override navigator userAgent
  Object.defineProperty(navigator, 'userAgent', {
    get: function() {
      return 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36';
    }
  });

  // Modify chrome runtime
  window.chrome = {
    runtime: {}
  };

  // Hide automation features
  Object.defineProperty(navigator, 'languages', {
    get: function() {
      return ['en-US', 'en'];
    }
  });

  // Add permissions API
  const originalQuery = window.navigator.permissions?.query || (() => {});
  window.navigator.permissions = {
    ...window.navigator.permissions,
    query: function(parameters) {
      if (parameters.name === 'notifications') {
        return Promise.resolve({ state: Notification.permission });
      }
      return originalQuery.call(this, parameters);
    }
  };

  // Add fake plugins data
  Object.defineProperty(navigator, 'plugins', {
    get: function() {
      const plugins = [
        {
          name: 'Chrome PDF Plugin',
          description: 'Portable Document Format',
          filename: 'internal-pdf-viewer',
          length: 1
        },
        {
          name: 'Chrome PDF Viewer',
          description: '',
          filename: 'mhjfbmdgcfjbbpaeojofohoefgiehjai',
          length: 1
        },
        {
          name: 'Native Client',
          description: '',
          filename: 'internal-nacl-plugin',
          length: 2
        }
      ];
      return plugins;
    }
  });
}
